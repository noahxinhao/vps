svGlobal.RdpPlayer=function(){function q(){d=lastTime=totalTime=0;timeOut=rdp=null;f=!1;a.state=a.CLOSED;d=lastTime=totalTime=0;timeOut=rdp=null;f=!1}function k(a,b){return(a[b]&255)<<24|(a[b+1]&255)<<16|(a[b+2]&255)<<8|a[b+3]&255}function r(){lastTime+=l;a.onprogress(lastTime,totalTime)}function s(c,b){if(a.state!=a.PLAYING)d-=8;else{var e=c.target.result;if(a.state==a.PLAYING){var g=f?0:b-lastTime;10>g&&(g=0);timeOut=setTimeout(function(){m&&(clearInterval(m),m=0);if(a.onprogress)a.onprogress(b,
totalTime);lastTime=b;a.state==a.PLAYING?(a.onmessage({data:e}),d+=e.byteLength,h(8,n)):d-=8},g);g>3*l&&(m=setInterval(r,l))}}}function n(c){if(a.state==a.PLAYING){var b=new Int8Array(c.target.result);if(8!=b.length){if(a.onprogress)a.onprogress(totalTime,totalTime);a.close();console.log("ssssss xxx len="+b.length)}else{c=k(b,0);var e=k(b,4);1>e&&(console.error("Duration:"+e),e=1);b=function(a){s(a,e)};a.state==a.PLAYING&&(d+=8,h(c,b))}}}function t(c){var b=new Int8Array(c.target.result);if(82!=b[0]&&
68!=b[1]&&80!=b[2]&&86!=b[3])alert(__svi18n.player.fmterror);else{c=(b[4]&255)<<8|b[5]&255;var e=(b[6]&255)<<8|b[7]&255,g=(b[8]&255)<<8|b[9]&255,f=b[10]&255;lastTime=0;totalTime=k(b,19)<<32|k(b,23);console.log("total time:"+totalTime);l=totalTime/100|0;(b=svManager.getInstance())&&b.close();rdp=new svGlobal.Rdp(a,e,g,f);rdp.displayMsg=!1;b=new svGlobal.LocalInterface;b.setReadOnly(!0);b.hideWhenClose=!1;rdp.addSurface(b);rdp.run();if(a.onopen)a.onopen();if(a.onopened)a.onopened({width:e,height:g,
color:f,version:c,length:totalTime,size:p.size});d=64;h(8,n)}}function h(c,b){if(a.state!=a.PLAYING){if(8==c)return;d-=8}var e=p.slice(d,d+c);reader=new FileReader;reader.onload=b;reader.readAsArrayBuffer(e)}var a=this,d=lastTime=totalTime=0,l=0,m=0,p=timeOut=rdp=reader=null,f=terminated=!1;this.PLAYING=0;this.PAUSED=1;this.state=this.CLOSED=3;this.close=function(){console.log("Player closed");try{a.onclose&&(a.onclose({code:0,reason:""}),a.onclose=null),rdp&&(rdp.close(),rdp=null)}finally{q()}};
this.setSource=function(c){if(reader){try{reader.abort()}catch(b){}reader=null}a.state==a.PLAYING?(a.state=a.CLOSED,terminated=!0,timeOut&&(clearTimeout(timeOut),timeOut=null),a.close()):(q(),terminated=!1);if(c){if(!("slice"in c||(c.slice=c.webkitSlice||c.mozSlice,"slice"in c))){alert(__svi18n.file.slice);return}p=c}else alert(__svi18n.player.noinput)};this.send=function(){};this.play=function(){a.state=a.PLAYING;if(0==d){var c=function(){d=0;h(64,t)};terminated?setTimeout(c,888):c()}else h(8,n)};
this.scan=function(a){f=a};this.pause=function(){a.state=a.PAUSED}};
